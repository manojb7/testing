#!/usr/bin/env python3
"""
Destroy Gardener Shoot Cluster
"""

import os
from pprint import pprint
import landscape_tools
import yaml
from python_path import PythonPath

with PythonPath("../../../", relative_to=__file__):
    from library.python.lib import common, gardener, lscrypt, config

def main():
    # resolve required params
    config_object = config.Config()
    
    print(f"[INFO] Configuration loaded")
    config_object.print_config()
    
    print(f"[INFO] Writing kubeconfig file")
    config_object.write_kubeconfig_file()
    
    print(f"[INFO] Creating Gardener Helper")
    gardener_helper = config_object.get_gardener_helper()
    
    print(f"[INFO] Deleting shoot cluster")
    # The delete_shoot method doesn't need the shoot path - it uses the cluster name from initialization
    gardener_helper.delete_shoot()
    
    print(f"[INFO] Polling for deletion status")
    deletion_status = gardener_helper.poll_shoot_deletion_status(timeout=300, interval=10)
    
    with landscape_tools.color_output("green"):
        print(f"Deletion status: {deletion_status}")
    
    if deletion_status is True:
        print("[SUCCESS] Shoot cluster deleted successfully")
    else:
        print("[WARN] Shoot deletion may still be in progress. Check the Gardener dashboard for status.")

if __name__ == "__main__":
    main()
